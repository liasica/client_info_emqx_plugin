%% -*- mode: erlang -*-
{deps, [
    {emqx_plugin_helper, {git, "https://github.com/emqx/emqx-plugin-helper.git", {tag, "v5.9.2"}}}
]}.

{plugins, [
    {emqx_plugin_helper, {git, "https://github.com/emqx/emqx-plugin-helper.git", {tag, "v5.9.2"}}}
]}.

{project_plugins, [{erlfmt, "1.6.0"}]}.

{erl_opts, [debug_info]}.

%% Sync release version to app version in VERSION file.
%% app.src uses: {vsn, {file, "VERSION"}}.
{pre_hooks, [
    {"(linux|darwin)", compile,
        "erl -noshell -eval '{ok, Terms} = file:consult(\"rebar.config\"), "
        "{relx, Relx} = lists:keyfind(relx, 1, Terms), "
        "{release, {_, Vsn}, _} = lists:keyfind(release, 1, Relx), "
        "ok = file:write_file(\"VERSION\", [Vsn, $\\n]), "
        "halt().'"}
]}.

%% this is the plugin release version.
{relx, [
    {release, {client_info_emqx_plugin, "1.1.1"}, [
        client_info_emqx_plugin,
        emqx_plugin_helper
    ]},
    {dev_mode, false},
    {include_erts, false},
    {include_src, false}
]}.

%% Additional info of the plugin
{emqx_plugrel, [
    {authors, ["liasica"]},
    {builder, [
        {name, "liasica"},
        {contact, "magicrolan@qq.com"},
        {website, "https://github.com/liasica/client_info_emqx_plugin"}
    ]},
    {repo, "https://github.com/liasica/client_info_emqx_plugin"},
    {functionality, ["Demo"]},
    {compatibility, [{emqx, "~> 5.7"}]},
    {description, "Another amazing EMQX plugin."}
]}.
